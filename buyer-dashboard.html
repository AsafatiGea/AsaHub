<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Buyer Dashboard ‚Äî AsaHub</title>
  <link rel="icon" type="image/png" href="../img/logo.png">
  <link href="https://fonts.googleapis.com/css2?family=Syne:wght@400;600;700;800&family=DM+Sans:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link rel="stylesheet" href="../css/Stakeholder/buyer.css">
</head>
<body>
  <div class="dashboard-wrapper">
    <div class="sidebar-overlay" aria-hidden="true"></div>

    <!-- ========== SIDEBAR ========== -->
    <aside class="sidebar" id="sidebar">
      <div class="sidebar-header">
        <a href="../index.html" class="sidebar-logo">
          <span class="icon" aria-hidden="true">üõí</span>
          <span>AsaHub</span>
        </a>
        <button type="button" class="sidebar-collapse-btn" aria-label="Ciutkan sidebar">¬´</button>
        <button type="button" class="sidebar-close" aria-label="Tutup menu">&times;</button>
      </div>
      <nav class="sidebar-nav">
        <ul>
          <li><a href="#" data-section="section-dashboard" class="active"><span class="icon">üìä</span><span>Dashboard</span></a></li>
          <li><a href="#" data-section="section-cart"><span class="icon">üõí</span><span>Keranjang</span></a></li>
          <li><a href="#" data-section="section-orders"><span class="icon">üìã</span><span>Pesanan Saya</span></a></li>
          <li><a href="#" data-section="section-history"><span class="icon">üìú</span><span>Riwayat Pembelian</span></a></li>
          <li><a href="#" data-section="section-profile"><span class="icon">üë§</span><span>Profil</span></a></li>
          <li><a href="#" data-section="section-address"><span class="icon">üìç</span><span>Alamat</span></a></li>
        </ul>
      </nav>
      <div class="sidebar-footer">
        <a href="../login.html" class="logout-btn"><span class="icon">üö™</span><span>Logout</span></a>
      </div>
    </aside>

    <!-- ========== MAIN CONTENT ========== -->
    <main class="main-content">
      <header class="top-navbar">
        <div class="navbar-left">
          <button type="button" class="sidebar-toggle" aria-label="Buka menu">‚ò∞</button>
          <h1 class="page-title">Buyer Dashboard</h1>
        </div>
        <div class="navbar-right">
          <div class="user-badge">
            <span class="avatar">B</span>
            <span>Buyer</span>
          </div>
        </div>
      </header>

      <div class="content-area">
        <!-- ---------- Section: Dashboard ---------- -->
        <section id="section-dashboard" class="dashboard-section active">
          <div class="card">
            <h2 class="card-title">Ringkasan Pesanan</h2>
            <div class="stats-grid">
              <div class="stat-card">
                <h3>Pending</h3>
                <p class="value" id="buyer-stat-pending">0</p>
              </div>
              <div class="stat-card blue">
                <h3>Dikirim</h3>
                <p class="value" id="buyer-stat-shipped">0</p>
              </div>
              <div class="stat-card green">
                <h3>Selesai</h3>
                <p class="value" id="buyer-stat-done">0</p>
              </div>
            </div>
          </div>
          <div class="card">
            <h2 class="card-title">Pesanan Terkini</h2>
            <div class="table-wrapper">
              <table>
                <thead>
                  <tr>
                    <th>ID Order</th>
                    <th>Total</th>
                    <th>Status</th>
                    <th>Tanggal</th>
                    <th>Aksi</th>
                  </tr>
                </thead>
                <tbody id="buyer-dashboard-orders">
                </tbody>
              </table>
            </div>
          </div>
        </section>

        <!-- ---------- Section: Keranjang ---------- -->
        <section id="section-cart" class="dashboard-section">
          <div class="card">
            <h2 class="card-title">Keranjang Belanja</h2>
            <div class="table-wrapper">
              <table>
                <thead>
                  <tr>
                    <th>Produk</th>
                    <th>Seller</th>
                    <th>Harga</th>
                    <th>Qty</th>
                    <th>Subtotal</th>
                    <th>Aksi</th>
                  </tr>
                </thead>
                <tbody id="buyer-cart-tbody">
                </tbody>
              </table>
            </div>
            <div class="text-right mt-1">
              <strong>Total: <span id="cart-total">Rp 0</span></strong>
              <button type="button" class="btn btn-primary mt-1">Checkout</button>
            </div>
          </div>
        </section>

        <!-- ---------- Section: Pesanan Saya ---------- -->
        <section id="section-orders" class="dashboard-section">
          <div class="card">
            <h2 class="card-title">Pesanan Saya</h2>
            <div class="table-wrapper">
              <table>
                <thead>
                  <tr>
                    <th>ID Order</th>
                    <th>Items</th>
                    <th>Total</th>
                    <th>Status</th>
                    <th>Tanggal</th>
                    <th>Aksi</th>
                  </tr>
                </thead>
                <tbody id="buyer-orders-tbody">
                </tbody>
              </table>
            </div>
          </div>
        </section>

        <!-- ---------- Section: Riwayat Pembelian ---------- -->
        <section id="section-history" class="dashboard-section">
          <div class="card">
            <h2 class="card-title">Riwayat Pembelian</h2>
            <div class="table-wrapper">
              <table>
                <thead>
                  <tr>
                    <th>ID Order</th>
                    <th>Items</th>
                    <th>Total</th>
                    <th>Status</th>
                    <th>Tanggal</th>
                    <th>Aksi</th>
                  </tr>
                </thead>
                <tbody id="buyer-history-tbody">
                </tbody>
              </table>
            </div>
          </div>
        </section>

        <!-- ---------- Section: Profil ---------- -->
        <section id="section-profile" class="dashboard-section">
          <div class="card">
            <h2 class="card-title">Profil Saya</h2>
            <div class="profile-header">
              <div class="profile-avatar" id="buyer-avatar">B</div>
              <div class="profile-info">
                <h2 id="buyer-name">Nama Buyer</h2>
                <p id="buyer-email" class="text-muted">buyer@example.com</p>
              </div>
            </div>
            <form id="form-buyer-profile" style="max-width: 560px;">
              <div class="form-group">
                <label for="buyer-name-input">Nama Lengkap</label>
                <input type="text" id="buyer-name-input" class="form-control" required>
              </div>
              <div class="form-group">
                <label for="buyer-email-input">Email</label>
                <input type="email" id="buyer-email-input" class="form-control" required>
              </div>
              <div class="form-group">
                <label for="buyer-phone">Nomor HP</label>
                <input type="tel" id="buyer-phone" class="form-control" placeholder="08xxxxxxxxxx">
              </div>
              <div class="form-group">
                <label for="buyer-address">Alamat Pengiriman</label>
                <textarea id="buyer-address" class="form-control" rows="3" placeholder="Alamat lengkap"></textarea>
              </div>
              <div class="form-group">
                <label>Foto Profil</label>
                <input type="file" id="buyer-photo" class="form-control" accept="image/*">
              </div>
              <button type="submit" class="btn btn-primary">Simpan Profil</button>
            </form>
          </div>
        </section>

        <!-- ---------- Section: Alamat ---------- -->
        <section id="section-address" class="dashboard-section">
          <div class="card">
            <h2 class="card-title">Daftar Alamat</h2>
            <p class="text-muted mb-0">Kelola alamat pengiriman.</p>
            <div id="buyer-address-list" class="mt-1">
              <!-- Diisi JS -->
            </div>
          </div>
        </section>
      </div>
    </main>
  </div>

  <script src="../js/supabase.js"></script>
<script src="../js/auth.js"></script>
<script src="../js/Stakeholder/buyer.js"></script>
  <script>
    (function () {
      var DUMMY = window.AsaHubDashboard.DUMMY;
      var formatRupiah = window.AsaHubDashboard.formatRupiah;
      var orders = DUMMY.buyerOrders;
      var cart = DUMMY.cart;
      var profile = DUMMY.buyerProfile;
      var addresses = DUMMY.addresses;

      // Stat ringkasan
      var pending = orders.filter(function (o) { return o.status === 'Pending'; }).length;
      var shipped = orders.filter(function (o) { return o.status === 'Dikirim'; }).length;
      var done = orders.filter(function (o) { return o.status === 'Selesai'; }).length;
      document.getElementById('buyer-stat-pending').textContent = pending;
      document.getElementById('buyer-stat-shipped').textContent = shipped;
      document.getElementById('buyer-stat-done').textContent = done;

      function statusBadge(s) {
        var c = s === 'Selesai' ? 'badge-success' : (s === 'Dikirim' ? 'badge-info' : 'badge-warning');
        return '<span class="badge ' + c + '">' + s + '</span>';
      }

      function orderRow(o, showDetail) {
        var btn = showDetail !== false ? '<button type="button" class="btn btn-primary btn-sm">Lihat Detail</button>' : '';
        return '<tr><td>' + o.id + '</td><td>' + (o.items || '-') + '</td><td>' + formatRupiah(o.total) +
          '</td><td>' + statusBadge(o.status) + '</td><td>' + o.date + '</td><td>' + btn + '</td></tr>';
      }

      // Dashboard orders (tanpa kolom items)
      var dashHtml = orders.map(function (o) {
        return '<tr><td>' + o.id + '</td><td>' + formatRupiah(o.total) + '</td><td>' + statusBadge(o.status) +
          '</td><td>' + o.date + '</td><td><button type="button" class="btn btn-primary btn-sm">Lihat Detail</button></td></tr>';
      }).join('');
      document.getElementById('buyer-dashboard-orders').innerHTML = dashHtml;

      // Pesanan Saya & Riwayat
      var ordersHtml = orders.map(function (o) { return orderRow(o); }).join('');
      document.getElementById('buyer-orders-tbody').innerHTML = ordersHtml;
      document.getElementById('buyer-history-tbody').innerHTML = ordersHtml;

      // Keranjang
      var cartTotal = 0;
      var cartHtml = cart.map(function (c) {
        var sub = c.price * c.qty;
        cartTotal += sub;
        return '<tr><td>' + c.name + '</td><td>' + c.seller + '</td><td>' + formatRupiah(c.price) +
          '</td><td>' + c.qty + '</td><td>' + formatRupiah(sub) + '</td><td><button type="button" class="btn btn-danger btn-sm">Hapus</button></td></tr>';
      }).join('');
      document.getElementById('buyer-cart-tbody').innerHTML = cartHtml || '<tr><td colspan="6" class="empty-state">Keranjang kosong.</td></tr>';
      document.getElementById('cart-total').textContent = formatRupiah(cartTotal);

      // Profil
      document.getElementById('buyer-name').textContent = profile.name;
      document.getElementById('buyer-email').textContent = profile.email;
      document.getElementById('buyer-avatar').textContent = profile.name.charAt(0);
      document.getElementById('buyer-name-input').value = profile.name;
      document.getElementById('buyer-email-input').value = profile.email;
      document.getElementById('buyer-phone').value = profile.phone;
      document.getElementById('buyer-address').value = profile.address;

      document.getElementById('form-buyer-profile').addEventListener('submit', function (e) {
        e.preventDefault();
        document.getElementById('buyer-name').textContent = document.getElementById('buyer-name-input').value;
        document.getElementById('buyer-email').textContent = document.getElementById('buyer-email-input').value;
        document.getElementById('buyer-avatar').textContent = document.getElementById('buyer-name-input').value.charAt(0);
        alert('Profil disimpan (dummy).');
      });

      // Daftar alamat
      var addrHtml = addresses.map(function (a) {
        var def = a.isDefault ? ' <span class="badge badge-info">Default</span>' : '';
        return '<div class="card mt-1" style="padding: 1rem;"><strong>' + a.label + '</strong>' + def +
          '<p class="text-muted mb-0 mt-1">' + a.address + '</p><p class="text-muted">' + a.phone + '</p>' +
          '<button type="button" class="btn btn-secondary btn-sm">Edit</button>' +
          '<button type="button" class="btn btn-danger btn-sm">Hapus</button></div>';
      }).join('');
      document.getElementById('buyer-address-list').innerHTML = addrHtml;

      // Section switching
      function showSection(id) {
        document.querySelectorAll('.dashboard-section').forEach(function(s) {
          s.classList.remove('active');
        });
        document.getElementById(id).classList.add('active');
      }

      // Navigation
      document.querySelectorAll('.sidebar-nav a').forEach(function(link) {
        link.addEventListener('click', function(e) {
          e.preventDefault();
          var section = this.getAttribute('data-section');
          showSection(section);
        });
      });

      // Initialize buyer dashboard
      if (window.buyerManager) {
        window.buyerManager.init();
      }
    })();
  </script>
</body>
</html>