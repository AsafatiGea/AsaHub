<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Supabase Connection Test - AsaHub</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .test-container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .test-item {
            margin: 20px 0;
            padding: 15px;
            border-left: 4px solid #ddd;
            background: #f9f9f9;
        }
        .success {
            border-left-color: #4CAF50;
            background: #f1f8e9;
        }
        .error {
            border-left-color: #f44336;
            background: #ffebee;
        }
        .warning {
            border-left-color: #ff9800;
            background: #fff3e0;
        }
        button {
            background: #2196F3;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #1976D2;
        }
        pre {
            background: #f4f4f4;
            padding: 10px;
            border-radius: 5px;
            overflow-x: auto;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>üîç Supabase Connection Test</h1>
        <p>Halaman ini untuk testing koneksi Supabase dan API Keys</p>
        
        <div class="test-item">
            <h3>1. Supabase Config Check</h3>
            <button onclick="testConfig()">Test Configuration</button>
            <div id="configResult"></div>
        </div>

        <div class="test-item">
            <h3>2. Connection Test</h3>
            <button onclick="testConnection()">Test Connection</button>
            <div id="connectionResult"></div>
        </div>

        <div class="test-item">
            <h3>3. Database Test</h3>
            <button onclick="testDatabase()">Test Database Access</button>
            <div id="databaseResult"></div>
        </div>

        <div class="test-item">
            <h3>4. Auth Test</h3>
            <button onclick="testAuth()">Test Authentication</button>
            <div id="authResult"></div>
        </div>

        <div class="test-item">
            <h3>5. Current Config</h3>
            <button onclick="showCurrentConfig()">Show Current Config</button>
            <div id="currentConfig"></div>
        </div>
    </div>

    <!-- Supabase JS -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.39.7"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.39.7/dist/umd/index.js"></script>
    <script src="js/supabase-config.js"></script>
    <script>
        // Debug: Check if Supabase is loaded
        console.log('Supabase library:', window.supabase);
        console.log('Supabase config:', window.SUPABASE_CONFIG);
        console.log('Supabase client:', window.SupabaseClient);
        
        // Additional check
        if (typeof window.supabase === 'undefined') {
            console.error('Supabase library not loaded!');
            alert('Error: Supabase library not loaded. Check your internet connection.');
        }
        if (typeof window.SupabaseClient === 'undefined') {
            console.error('Supabase client not initialized!');
            alert('Error: Supabase client not initialized. Check configuration.');
        }
    </script>
    <script>
        function showResult(elementId, message, type = 'info') {
            const element = document.getElementById(elementId);
            element.innerHTML = `<div class="test-item ${type}">${message}</div>`;
        }

        function testConfig() {
            try {
                const config = window.SUPABASE_CONFIG;
                if (!config.url || config.url === 'YOUR_SUPABASE_URL') {
                    showResult('configResult', '‚ùå URL Supabase belum diisi! Masih menggunakan placeholder.', 'error');
                } else if (!config.anonKey || config.anonKey === 'YOUR_SUPABASE_ANON_KEY') {
                    showResult('configResult', '‚ùå Anon Key belum diisi! Masih menggunakan placeholder.', 'error');
                } else {
                    showResult('configResult', `‚úÖ Config terdeteksi:<br><pre>URL: ${config.url}<br>Key: ${config.anonKey.substring(0, 20)}...</pre>`, 'success');
                }
            } catch (error) {
                showResult('configResult', `‚ùå Error: ${error.message}`, 'error');
            }
        }

        async function testConnection() {
            try {
                showResult('connectionResult', '‚è≥ Testing connection...', 'warning');
                
                const { data, error } = await window.SupabaseClient.from('users').select('count').single();
                
                if (error) {
                    showResult('connectionResult', `‚ùå Connection failed: ${error.message}`, 'error');
                } else {
                    showResult('connectionResult', '‚úÖ Connection successful! Database accessible.', 'success');
                }
            } catch (error) {
                showResult('connectionResult', `‚ùå Connection error: ${error.message}`, 'error');
            }
        }

        async function testDatabase() {
            try {
                showResult('databaseResult', '‚è≥ Testing database access...', 'warning');
                
                // Test users table
                const { data: users, error: usersError } = await window.SupabaseClient.from('users').select('count').single();
                
                // Test products table
                const { data: products, error: productsError } = await window.SupabaseClient.from('products').select('count').single();
                
                // Test categories table
                const { data: categories, error: categoriesError } = await window.SupabaseClient.from('categories').select('count').single();
                
                let result = '<h4>Database Tables Access:</h4>';
                
                if (usersError) {
                    result += `‚ùå Users: ${usersError.message}<br>`;
                } else {
                    result += `‚úÖ Users: Accessible<br>`;
                }
                
                if (productsError) {
                    result += `‚ùå Products: ${productsError.message}<br>`;
                } else {
                    result += `‚úÖ Products: Accessible<br>`;
                }
                
                if (categoriesError) {
                    result += `‚ùå Categories: ${categoriesError.message}<br>`;
                } else {
                    result += `‚úÖ Categories: Accessible<br>`;
                }
                
                showResult('databaseResult', result, usersError || productsError || categoriesError ? 'error' : 'success');
            } catch (error) {
                showResult('databaseResult', `‚ùå Database test error: ${error.message}`, 'error');
            }
        }

        async function testAuth() {
            try {
                showResult('authResult', '‚è≥ Testing authentication...', 'warning');
                
                // Test auth configuration
                const { data: { session }, error } = await window.SupabaseClient.auth.getSession();
                
                if (error) {
                    showResult('authResult', `‚ùå Auth error: ${error.message}`, 'error');
                } else {
                    showResult('authResult', '‚úÖ Auth system working! No active session (this is normal).', 'success');
                }
            } catch (error) {
                showResult('authResult', `‚ùå Auth test error: ${error.message}`, 'error');
            }
        }

        function showCurrentConfig() {
            const config = window.SUPABASE_CONFIG;
            const configHtml = `
                <h4>Current Supabase Configuration:</h4>
                <pre>
URL: ${config.url}
Anon Key: ${config.anonKey}
Options: ${JSON.stringify(config.options, null, 2)}
                </pre>
                <h4>Expected Format:</h4>
                <pre>
URL: https://[project-id].supabase.co
Anon Key: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
                </pre>
            `;
            showResult('currentConfig', configHtml, 'info');
        }

        // Auto-run config test on page load
        window.addEventListener('load', function() {
            testConfig();
        });
    </script>
</body>
</html>
